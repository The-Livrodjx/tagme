<div class="table-container">
  <div class="table-header">
    <h2>Items</h2>
    <div class="header-actions">
      <button type="button" class="btn btn-primary" (click)="createItem()">
        + Novo Item
      </button>
      <div class="table-info">
        Total: {{ meta?.totalItems || 0 }} items
      </div>
    </div>
  </div>

  <div *ngIf="!loading &&meta?.totalItems == 0" class="empty-state">
    <div class="empty-message">
      <h3>Nenhum item cadastrado</h3>
      <p>Comece criando seu primeiro item.</p>
      <button type="button" class="btn btn-primary" (click)="createItem()">
        + Criar Primeiro Item
      </button>
    </div>
  </div>

  <div class="table-wrapper" *ngIf="!loading; else loadingTemplate">
    <table class="items-table" *ngIf="items.length > 0">
      <thead>
        <tr>
          <th>Foto</th>
          <th>ID</th>
          <th>T√≠tulo</th>
          <th>Descri√ß√£o</th>
          <th class="actions-column">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items; trackBy: trackByItemId" class="table-row">
          <td>
            <div class="photo-container">
              <img
                [src]="getPhotoUrl(item.photo)"
                [alt]="item.titulo || 'Item'"
                class="item-photo"
                (error)="onImageError($event)">
            </div>
          </td>
          <td class="id-cell">{{ item._id }}</td>
          <td>
            <span *ngIf="item.titulo; else noTitle" class="item-title">
              {{ item.titulo }}
            </span>
            <ng-template #noTitle>
              <span class="no-data">Sem t√≠tulo</span>
            </ng-template>
          </td>
          <td>
            <span *ngIf="item.descricao; else noDescription" class="item-description">
              {{ item.descricao | slice:0:100 }}{{ item.descricao && item.descricao.length > 100 ? '...' : '' }}
            </span>
            <ng-template #noDescription>
              <span class="no-data">Sem descri√ß√£o</span>
            </ng-template>
          </td>
          <td class="actions-cell">
            <div class="action-buttons">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                style="background: none"
                (click)="editItem(item._id)"
                title="Editar">
                ‚úèÔ∏è
              </button>
              <button
                type="button"
                class="btn btn-sm btn-danger"
                style="background: none"
                (click)="confirmDelete(item)"
                [disabled]="deleting() === item._id"
                title="Excluir">
                {{ deleting() === item._id ? '‚è≥' : 'üóëÔ∏è' }}
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagina√ß√£o -->
  <div class="pagination" *ngIf="meta && meta.totalPages > 1">
    <button
      type="button"
      class="btn btn-pagination"
      [disabled]="loading || !meta || meta.currentPage <= 1"
      (click)="changePage(meta.currentPage - 1)">
      Anterior
    </button>

    <div class="page-numbers">
      <ng-container *ngFor="let page of getPageNumbers(); trackBy: trackByPageNumber">
        <button
          type="button"
          class="btn btn-page"
          [class.active]="page === meta?.currentPage"
          [disabled]="loading"
          (click)="changePage(page)">
          {{ page }}
        </button>
      </ng-container>
    </div>

    <span class="pagination-info" *ngIf="meta">
      {{ meta.currentPage }} de {{ meta.totalPages }}
    </span>

    <button
      type="button"
      class="btn btn-pagination"
      [disabled]="loading || !meta || meta.currentPage >= meta.totalPages"
      (click)="changePage(meta.currentPage + 1)">
      Pr√≥xima
    </button>
  </div>

  <ng-template #loadingTemplate>
    <div class="loading">
      <div class="spinner"></div>
      Carregando items...
    </div>
  </ng-template>

  <!-- Modal de Confirma√ß√£o de Exclus√£o -->
  <div class="modal-overlay" *ngIf="showDeleteModal()" (click)="cancelDelete()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirmar Exclus√£o</h3>
        <button type="button" class="btn-close" (click)="cancelDelete()">√ó</button>
      </div>
      <div class="modal-body">
        <p>Tem certeza que deseja excluir o item:</p>
        <p><strong>{{ itemToDelete()?.titulo || 'Item sem t√≠tulo' }}</strong></p>
        <p class="warning">Esta a√ß√£o n√£o pode ser desfeita.</p>
      </div>
      <div class="modal-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="cancelDelete()"
          [disabled]="deleting()">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger"
          (click)="deleteItem()"
          [disabled]="deleting()">
          {{ deleting() ? 'Excluindo...' : 'Confirmar Exclus√£o' }}
        </button>
      </div>
    </div>
  </div>
</div>
